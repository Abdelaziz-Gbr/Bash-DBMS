#!/usr/bin/bash

prompt_table_name() {
    while true
    do
        read -p "Enter table name to create (or type '0' to go back): " tableName

        if [[ $tableName == "0" ]]; then
            exit 1
        fi

        if ! validate_table_name $tableName; then
            pause
            continue
        fi

        if table_exists $dbName $tableName; then
            echo "Table with the same name already exists. Choose another one!"
            pause
            continue
        fi

        break
    done
}

validate_table_name() {
    if [[ -z "$tableName" ]]; then
        echo "You must enter a table name!"
        return 1
    fi

    local result
    result=$(./inputValidator CHARS_ONLY "$tableName")

    if [[ $result != "0" ]]; then
        echo "Table name should be any combination of letters from A to Z or a to z"
        return 1
    fi

    return 0
}

table_exists() {
    [[ -f "./mydb/$dbName/$tableName" ]]
}

pause() {
    read -r -p "Press any key to try again..." -n1 -s
    echo
}

create_table_files() {
    touch "./mydb/$dbName/$tableName" "./mydb/$dbName/.$tableName.metadata"
}

main() {
    dbName=$1
    if [[ -z "$dbName" ]]; then
        echo "Database name is required"
        exit 1
    fi

    prompt_table_name
    create_table_files
    ./addTableColumn "$dbName" "$tableName"
    exit 0
}

main $@
